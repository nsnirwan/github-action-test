name: Appium Server Control

on:
  workflow_dispatch:
    inputs:
      action:
        description: Choose action
        required: true
        type: choice
        options: [start, stop, restart, status]

jobs:
  appium-server:
    runs-on: [self-hosted, macOS, X64]

    steps:
      - name: ğŸ§¾ Checkout Repository
        uses: actions/checkout@v4

      - name: âš™ï¸ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Install Dependencies 
        run: npm install wd --legacy-peer-deps
      - name: Install webdriverio 
        run: npm install webdriverio --save
      # - name: npm uninstall wdio-chromedriver-service
      #   run: npm uninstall wdio-chromedriver-service
        
      # - name: Install Appium Client
      #   run: npm install appium-client --save

      - name: ğŸ›¡ï¸ Make Script Executable
        run: chmod +x appium-server.sh launch-ios-app.js 

      - name: ğŸš¦ Run Appium Action
        run: ./appium-server.sh "${{ github.event.inputs.action }}"
      - name: ğŸ“± Launch iOS App
        if: ${{ github.event.inputs.action == 'start' }}
        run: node ./launch-ios-app.js

      - name: ğŸ“„ Upload Appium Logs (if any)
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: appium-log
          path: appium.log
