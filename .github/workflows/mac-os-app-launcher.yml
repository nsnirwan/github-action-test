name: Appium Test on Mac Mini

on:
  workflow_dispatch:

jobs:
  run-appium-tests:
    runs-on: [self-hosted, macOS, X64]

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'  # adjust as needed

      - name: Install Appium (if not already installed)
        run: |
          if ! command -v appium &> /dev/null; then
            npm install -g appium
          fi
      
      - name: üõ°Ô∏è Ensure Scripts Are Executable
        run: chmod +x start-appium.sh stop-appium.sh
      - name: Start Appium Server
        run: ./start-appium.sh

      - name: Wait for Appium to Start
        run: |
          for i in {1..10}; do
            echo "Checking Appium server status..."
            if curl -s http://localhost:4723/wd/hub/status | grep -q "Appium"; then
              echo "Appium is up!"
              break
            fi
            sleep 2
          done

      - name: Run Appium Tests
        run: |
          echo "üîß Place your test commands here"
          # Example using Mocha + WebDriverIO or any test runner:
          # npm install
          # npm test
          # ./gradlew connectedAndroidTest (if testing Android)

      - name: Stop Appium Server
        if: always()
        run: ./stop-appium.sh

      - name: Upload Appium Logs
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: appium-log
          path: appium.log
